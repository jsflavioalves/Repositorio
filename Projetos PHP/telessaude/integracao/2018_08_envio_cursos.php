<?php


$blacklist = [];

function createNewArrayCPFS($cpfs) {
	global $blacklist;
	$newsCPFS = array();
	for($i=0;$i<count($cpfs);$i++) {
		if(validaCPF($cpfs[$i])) {
			if(!in_array($cpfs[$i], $blacklist)) {
				$newsCPFS[] = $cpfs[$i];
			} 
		}
	}
	return $newsCPFS;
}

function validaCPF($cpf = null) {
 
    // Verifica se um número foi informado
    if(empty($cpf)) {
        return false;
    }
 
    // Elimina possivel mascara
    $cpf = @ereg_replace('[^0-9]', '', $cpf);
    $cpf = str_pad($cpf, 11, '0', STR_PAD_LEFT);
     
    // Verifica se o numero de digitos informados é igual a 11 
    if (strlen($cpf) != 11) {
        return false;
    }
    // Verifica se nenhuma das sequências invalidas abaixo 
    // foi digitada. Caso afirmativo, retorna falso
    else if ($cpf == '00000000000' || 
        $cpf == '11111111111' || 
        $cpf == '22222222222' || 
        $cpf == '33333333333' || 
        $cpf == '44444444444' || 
        $cpf == '55555555555' || 
        $cpf == '66666666666' || 
        $cpf == '77777777777' || 
        $cpf == '88888888888' || 
        $cpf == '99999999999') {
        return false;
     // Calcula os digitos verificadores para verificar se o
     // CPF é válido
     } else {   
         
        for ($t = 9; $t < 11; $t++) {
             
            for ($d = 0, $c = 0; $c < $t; $c++) {
                $d += $cpf{$c} * (($t + 1) - $c);
            }
            $d = ((10 * $d) % 11) % 10;
            if ($cpf{$c} != $d) {
                return false;
            }
        }
 
        return true;
    }
}




/*header("Content-Type: text/html; charset=utf-8");
require("classes/integra.class.php");
error_reporting(E_ALL);
ini_set("display_errors", 1);
set_time_limit(0);*/


header("Content-Type: text/html; charset=utf-8");
require("classes/integra.class.php");
error_reporting(E_ALL);
ini_set("display_errors", 1);
set_time_limit(0);
require_once('../includes/frameworkajax.php');



/*$profissionalTeleconsultorias = new ProfissionalSaude("0000088", "012018");
$cpfs = ["61514594315", "78806054368", "53227301334", "00122518365", "36904880368",
"83079882172", "85257249634", "30860490220", "01907607536", "91306922372", "11812773706", "00287308600", "02375223144", "24814305818", "90527569453", "01727601009", "00808351044", "00668996560", "07622391662", "71544992220", "04507018676", "05151431110", "03891450508", "99450437491", "82757950010", "00828207593", "10161177794", "02026611726", "01259282031", "03130129111", "82168482004", "56545401220", "03598011458", "10774827602", "04647967417", "01394992106", "05221551705", "01466643102", "04291718110", "02688427105", "65902300304", "02763119492", "02529402450", "23965444204", "02879998581", "00794656501", "09689236407", "36067741253", "01007406003", "00264591593", "02362669505", "78525314234", "39791319049", "89814193534", "35737913015", "03085713123", "84277017568", "52728170282", "09063223676", "80629083215", "01165691159", "01873617038", "04875949405", "07763173696", "93778260120", "01941431046", "04110096995", "97961078053", "84161639287", "00700939113", "06745241447", "00602057175", "04064762681", "00515995118", "10478026609", "92669573053", "02175332560", "02544614099", "77013042234", "28312104100", "10558825613", "80756930197", "25791993811", "57309116615", "04995931465", "77746716172", "60170921204", "04530920550", "06897848646", "71166556034", "00965311180", "83196439100", "02542356114", "00464871581", "05418256580", "02232020100", "00830760423", "64120309134", "05726453840", "75608928504", "73442666104", "50889427615", "02802828690", "03916213199", "00776125079", "06520627410", "91300550082", "86515407521", "54444519134", "00271375205", "01085282198", "02386866556", "03867274142", "01108082408", "86410830149", "04016635403", "21409528049", "67220541600", "75218526304", "04244096663", "03883998133", "02424593400",
"04454649332", 
"69876150120", "00480670080", "08667015679", "03597383467", "64986128353", "11293510688", "04333857660", "06656152481", "56954778168", "92635636320", "03731975351", "06673027436", "02247220509", "38486778816", "22386459349", "86216643215", "31932398368", "93795327253", "25860844387", "62501038215", "71615660100", "90339452234", "04552098551", "05244299875", "03761493100", "08832906694", "02749964130", "01850080119", "01553200683", "06246712673", "95917500053", "25875841320", "76892743315", "31694748472", "02342517513", "52994929104", "38898594372", "85310824391", "30686049829", "01137161337", "00296946125", "30999146300", "01001288319", "01554774551", "10389023639", "01908475579", "60511362749",
"76905810304", "89579461368", "72547880300", "05396381370", "65854187353", "76426459372", "87290650387", "00710366361", "92949185304", "37727885304", "49162462334", "44358539300", "75414503320", "61962180344", "95535888320", "04861610486", "70841136300", "70570140315", "42064554653", "71498915353", "78162939334", "01164474359", "46352090320", "00365736392", "74530410315", "61610100387", "01491042354", "84181060349", "46958525353", "02214894365", "02271382360", "24757993315", "53173619315", "50023292334", "89883128304", "78655277304", "01661149367", "02752072341", "04806754307", "03613477319", "67233309353", "65662113300", "22882588372", "03491535310", "79867316304", "84269464372", "05903446337", "04310984339", "95981632372", "30015669300", "02607064341", "45606110334", "02364434378", "01554434378", "60051875381", "00538913339", "23028050382", "04038782336", "23196629368", "61756989320", "73591262315", "00551726369"];
for($i=0;$i<count($cpfs);$i++) {
	$sql = "select 	itp.nome, itp.codigo_cbo, itp.estabelecimento_codigo_cnes, coalesce(itp.equipe_codigo_ine, 'null') as equipe_codigo_ine, tu.fl_sexo
from integracao.tb_profissional as itp 
inner join tb_profissional tp on(itp.cpf=replace(replace(tp.nr_cpf, '.', ''), '-', ''))
inner join tb_usuario tu on(tp.ci_profissional=tu.ci_usuario)
where itp.cpf = '" . $cpfs[$i] . "'
";	
	$q = query($sql)->fetch();
	if($q['codigo_cbo'] != '' || $q['estabelecimento_codigo_cnes'] != '') {
		$fl_sexo = "M";
		if($q['fl_sexo'] == '2'){
			$fl_sexo = "F";
		}
		
		$cnes = $q['estabelecimento_codigo_cnes'];
		if(strlen($cnes) == 4){
			$cnes = '000'.$cnes;
		}
		if(strlen($cnes) == 5){
			$cnes = '00'.$cnes;
		}
		
		$profissionalTeleconsultorias->addProfissionalSaude(null, $cpfs[$i], $q['nome'], $cnes, $q['codigo_cbo'], null, "02", $fl_sexo);
	}
}*/


/*
Código de identificação 
Data/hora de início do curso
Data/hora de término do curso
Número de vagas ofertadas
Tema do curso
Carga horaria do curso - Número em minutos
Alunos matriculados	(opcional) Lista de CPFs separados por vírgula dos alunos matriculados	Em um primeiro momento, o SMART recebe apenas os dados do curso para cadastro, depois poderá receber a lista de CPFs
Alunos formados	(opcional) Lista de CPFs separados por vírgula dos alunos formados	Quando o curso tiver sido encerrado, poderá enviar os dados do curso com a lista de formados
Alunos evadidos	(opcional) Lista de CPFs separados por vírgula dos alunos evadidos	Quando o curso tiver sido encerrado, poderá enviar os dados do curso com a lista de evadidos
Alunos reprovados	(opcional) Lista de CPFs separados por vírgula dos alunos reprovados	Quando o curso tiver sido encerrado, poderá enviar os dados do curso com a lista de reprovados
*/



$curso = new TeleeducacaoCurso("0000088", "082018");
$curso->addCurso("WD22018B1", "13/08/2018 00:00:00", "31/08/2018 00:00:00", "250", " SP3.071", "2400", 
//matriculados
createNewArrayCPFS(['00858462443',
'00327088311',
'68585390344',
'71974164349',
'10278562418',
'02384195336',
'31802367870',
'04689511993',
'36846902368',
'39461255810',
'01540891330',
'70299854353',
'07457942467',
'73499986949',
'57200297020',
'99439158387',
'02996198930',
'00042429471',
'01188018485',
'89286472315',
'03098555866',
'97514780734',
'32644660823',
'73772712304',
'05228756612',
'39054926600',
'05399706709',
'05645685628',
'05665305707',
'75898659234',
'38086910857',
'00566036304',
'77807235500',
'03066747000',
'86841041291',
'07087606433',
'05846411339',
'03134671026',
'03716841960',
'04566755312',
'29804557843',
'08252379710',
'02463683490',
'00824176448',
'02626924733',
'02347516302',
'86458299320',
'94152357649',
'36436376836',
'00028338758',
'55533426434',
'32625837829',
'95271007049',
'69027064504',
'14512528709',
'09054694700',
'08304968150',
'03437567659',
'89278666300',
'98750593587',
'68397712020',
'02007148307',
'28645250896',
'03943157407',
'03198102405',
'40678186880',
'35016245819',
'43472850353',
'60369090390',
'01223326608',
'77355822349',
'77782640300',
'61771708387',
'02766521348',
'07817016607',
'65424972691',
'22674879858',
'04201834425',
'51136244387',
'04337644490',
'20885083334',
'02525436539',
'02506635033',
'01972423088',
'89515390915',
'04894405504',
'22328582869',
'04140585340',
'00088789004',
'27063277820',
'25444853884',
'03007868670',
'05238061757',
'89990790310',
'30314153888',
'04817544317',
'03341024646',
'06245074673',
'00556243676',
'05978299420',
'36181396837',
'00975241311',
'84181060349',
'01046427342',
'04551300357',
'08389562111',
'02214894365',
'13851317726',
'56840632687',
'61532622368',
'04920962444',
'59896450900',
'01177975378',
'05245713330',
'02493645901',
'39686701320',
'06142259492',
'29753284861',
'03619576106',
'01401469620',
'93653581591',
'62066510378',
'65287967349',
'04191313371',
'02491039230',
'08766406927',
'01050153421',
'08930132421',
'05699604448',
'08682087448',
'27505901400',
'04200102382',
'87075415620',
'00522501729',
'86780042153',
'07531280639',
'00923140409',
'04378176440',
'07963487406',
'89048261368',
'00246268727',
'12055296752',
'02482275300',
'61232084700',
'44735936068',
'48598720372',
'07551329803',
'06140800617',
'02746572362',
'04626725490',
'67257208700',
'61822655668',
'29443024420',
'64639908091',
'07482335633',
'37540848871',
'36970832449',
'38908319824',
'39057895234',
'01405099410',
'61452874387',
'93638019934',
'07807172797',
'39834344368',
'05941767439',
'04094171819',
'13118242434',
'33645458808',
'00263210847',
'98656198572',
'01205397809',
'51728257115',
'62865552691',
'54909830600',
'71487190034',
'93393261649',
'08980769784',
'35261731844',
'79859100500',
'29754669864',
'08641120688',
'40080042899',
'12641551748',
'10588729400',
'43351417349',
'61992488304',
'10404609414',
'34473711889',
'02849700770',
'03126903630',
'72953152687',
'58219455349',
'05505719651',
'36880095844',
'18379038835',
'27571722802',
'73027570382',
'18637559859',
'61550310372',
'02845793782',
'97147435400',
'84022434368',
'65385225134',
'06426412422',
'10602612608',
'00897255496',
'31813879320',
'01039876498',
'08149680829',
'01331739683',
'03127571666',
'40224457500',
'05810238467',
'03593640716',
'02663698717',
'50109588568',
'04875693427',
'05159444408',
'10148729444',
'01405311495',
'12743725850',
'51031329749',
'41882501861',
'62889583791',
'04643634383',
'92934986268',
'30298393387',
'85716723349',
'48346730730',
'02663008397',
'08160038151',
'08164906190',
'89355393172']), 
//concluintes
createNewArrayCPFS(['00327088311',
'39461255810',
'02996198930',
'05228756612',
'05645685628',
'04566755312',
'14512528709',
'08304968150',
'60369090390',
'22328582869',
'01046427342',
'01050153421',
'10588729400',
'10404609414',
'27571722802',
'10602612608',
'85716723349',
'08164906190']), 
//evadidos
createNewArrayCPFS(['00858462443',
'68585390344',
'71974164349',
'10278562418',
'02384195336',
'31802367870',
'36846902368',
'01540891330',
'70299854353',
'07457942467',
'73499986949',
'57200297020',
'99439158387',
'00042429471',
'01188018485',
'89286472315',
'03098555866',
'97514780734',
'32644660823',
'73772712304',
'39054926600',
'05399706709',
'05665305707',
'75898659234',
'38086910857',
'77807235500',
'03066747000',
'86841041291',
'07087606433',
'05846411339',
'03134671026',
'03716841960',
'29804557843',
'08252379710',
'02463683490',
'00824176448',
'02626924733',
'02347516302',
'94152357649',
'36436376836',
'00028338758',
'55533426434',
'32625837829',
'95271007049',
'69027064504',
'09054694700',
'03437567659',
'89278666300',
'98750593587',
'68397712020',
'28645250896',
'03198102405',
'40678186880',
'35016245819',
'43472850353',
'01223326608',
'77355822349',
'77782640300',
'61771708387',
'02766521348',
'07817016607',
'22674879858',
'04201834425',
'51136244387',
'04337644490',
'20885083334',
'02506635033',
'01972423088',
'89515390915',
'04894405504',
'04140585340',
'27063277820',
'25444853884',
'03007868670',
'05238061757',
'30314153888',
'04817544317',
'03341024646',
'06245074673',
'00556243676',
'05978299420',
'36181396837',
'00975241311',
'84181060349',
'04551300357',
'08389562111',
'02214894365',
'56840632687',
'61532622368',
'04920962444',
'59896450900',
'05245713330',
'02493645901',
'39686701320',
'06142259492',
'29753284861',
'03619576106',
'01401469620',
'93653581591',
'62066510378',
'65287967349',
'08766406927',
'08930132421',
'05699604448',
'08682087448',
'27505901400',
'04200102382',
'87075415620',
'00522501729',
'86780042153',
'07531280639',
'00923140409',
'04378176440',
'07963487406',
'89048261368',
'00246268727',
'12055296752',
'02482275300',
'61232084700',
'44735936068',
'48598720372',
'07551329803',
'06140800617',
'02746572362',
'04626725490',
'67257208700',
'61822655668',
'29443024420',
'64639908091',
'07482335633',
'37540848871',
'36970832449',
'39057895234',
'01405099410',
'61452874387',
'93638019934',
'07807172797',
'39834344368',
'05941767439',
'04094171819',
'13118242434',
'33645458808',
'00263210847',
'98656198572',
'01205397809',
'51728257115',
'62865552691',
'54909830600',
'71487190034',
'93393261649',
'08980769784',
'35261731844',
'08641120688',
'40080042899',
'12641551748',
'43351417349',
'61992488304',
'34473711889',
'02849700770',
'03126903630',
'72953152687',
'58219455349',
'05505719651',
'36880095844',
'18379038835',
'73027570382',
'18637559859',
'61550310372',
'02845793782',
'97147435400',
'84022434368',
'65385225134',
'06426412422',
'00897255496',
'31813879320',
'01039876498',
'08149680829',
'01331739683',
'40224457500',
'05810238467',
'03593640716',
'02663698717',
'50109588568',
'04875693427',
'10148729444',
'01405311495',
'12743725850',
'51031329749',
'62889583791',
'04643634383',
'92934986268',
'30298393387',
'48346730730',
'02663008397',
'08160038151',
'89355393172']), 
//reprovados
createNewArrayCPFS(['04689511993',
'00566036304',
'86458299320',
'02007148307',
'03943157407',
'65424972691',
'02525436539',
'00088789004',
'89990790310',
'13851317726',
'01177975378',
'04191313371',
'02491039230',
'38908319824',
'79859100500',
'29754669864',
'03127571666',
'05159444408',
'41882501861']));





////////////////////////////////////////////////////////////////
//INTEGRA
$url = 'http://smart.telessaude.ufrn.br/';
$integra = new Integra("ad9c2aa3622033fc9d79703fde22a4e892641221");



/*echo "<br/><br/><fieldset><legend>Teleconsultoria - Profissionais de Saúde</legend>";
$dados_profissionalTeleconsultorias = Integra::serializar(TipoDeDados::JSON, $profissionalTeleconsultorias);
echo "<h3>.: Dados Serializados - Profissional de Saúde :.</h3>";
echo $dados_profissionalTeleconsultorias;
$resposta_profissional = $integra->enviarDados(TipoDeDados::JSON, $url."api/v2/profissionais-saude/?format=json", $dados_profissionalTeleconsultorias);
echo "<h3>.: Resposta do Servidor - Profissional de Saúde :.</h3>";
echo $resposta_profissional;
echo "</fieldset>";
*/

////////////////////////////////////////////////////////////////
//1 - Cursos

echo "<br/><br/><fieldset><legend>Cursos</legend>";
$dados_serializados_curso = Integra::serializar(TipoDeDados::JSON, $curso);
echo "<h3>.: Dados Serializados - Curso :.</h3>";
echo $dados_serializados_curso;
$resposta_curso = $integra->enviarDados(TipoDeDados::JSON, $url."api/v2/cursos-teleeducacao/?format=json", $dados_serializados_curso);
echo "<h3>.: Resposta do Servidor - Curso :.</h3>";
echo $resposta_curso;
echo "</fieldset>";





?>