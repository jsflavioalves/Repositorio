<?php


$blacklist = [];

function createNewArrayCPFS($cpfs) {
	global $blacklist;
	$newsCPFS = array();
	for($i=0;$i<count($cpfs);$i++) {
		if(validaCPF($cpfs[$i])) {
			if(!in_array($cpfs[$i], $blacklist)) {
				$newsCPFS[] = $cpfs[$i];
			} 
		}
	}
	return $newsCPFS;
}

function validaCPF($cpf = null) {
 
    // Verifica se um número foi informado
    if(empty($cpf)) {
        return false;
    }
 
    // Elimina possivel mascara
    $cpf = @ereg_replace('[^0-9]', '', $cpf);
    $cpf = str_pad($cpf, 11, '0', STR_PAD_LEFT);
     
    // Verifica se o numero de digitos informados é igual a 11 
    if (strlen($cpf) != 11) {
        return false;
    }
    // Verifica se nenhuma das sequências invalidas abaixo 
    // foi digitada. Caso afirmativo, retorna falso
    else if ($cpf == '00000000000' || 
        $cpf == '11111111111' || 
        $cpf == '22222222222' || 
        $cpf == '33333333333' || 
        $cpf == '44444444444' || 
        $cpf == '55555555555' || 
        $cpf == '66666666666' || 
        $cpf == '77777777777' || 
        $cpf == '88888888888' || 
        $cpf == '99999999999') {
        return false;
     // Calcula os digitos verificadores para verificar se o
     // CPF é válido
     } else {   
         
        for ($t = 9; $t < 11; $t++) {
             
            for ($d = 0, $c = 0; $c < $t; $c++) {
                $d += $cpf{$c} * (($t + 1) - $c);
            }
            $d = ((10 * $d) % 11) % 10;
            if ($cpf{$c} != $d) {
                return false;
            }
        }
 
        return true;
    }
}




/*header("Content-Type: text/html; charset=utf-8");
require("classes/integra.class.php");
error_reporting(E_ALL);
ini_set("display_errors", 1);
set_time_limit(0);*/


header("Content-Type: text/html; charset=utf-8");
require("classes/integra.class.php");
error_reporting(E_ALL);
ini_set("display_errors", 1);
set_time_limit(0);
require_once('../includes/frameworkajax.php');



/*$profissionalTeleconsultorias = new ProfissionalSaude("0000088", "012018");
$cpfs = ["61514594315", "78806054368", "53227301334", "00122518365", "36904880368",
"83079882172", "85257249634", "30860490220", "01907607536", "91306922372", "11812773706", "00287308600", "02375223144", "24814305818", "90527569453", "01727601009", "00808351044", "00668996560", "07622391662", "71544992220", "04507018676", "05151431110", "03891450508", "99450437491", "82757950010", "00828207593", "10161177794", "02026611726", "01259282031", "03130129111", "82168482004", "56545401220", "03598011458", "10774827602", "04647967417", "01394992106", "05221551705", "01466643102", "04291718110", "02688427105", "65902300304", "02763119492", "02529402450", "23965444204", "02879998581", "00794656501", "09689236407", "36067741253", "01007406003", "00264591593", "02362669505", "78525314234", "39791319049", "89814193534", "35737913015", "03085713123", "84277017568", "52728170282", "09063223676", "80629083215", "01165691159", "01873617038", "04875949405", "07763173696", "93778260120", "01941431046", "04110096995", "97961078053", "84161639287", "00700939113", "06745241447", "00602057175", "04064762681", "00515995118", "10478026609", "92669573053", "02175332560", "02544614099", "77013042234", "28312104100", "10558825613", "80756930197", "25791993811", "57309116615", "04995931465", "77746716172", "60170921204", "04530920550", "06897848646", "71166556034", "00965311180", "83196439100", "02542356114", "00464871581", "05418256580", "02232020100", "00830760423", "64120309134", "05726453840", "75608928504", "73442666104", "50889427615", "02802828690", "03916213199", "00776125079", "06520627410", "91300550082", "86515407521", "54444519134", "00271375205", "01085282198", "02386866556", "03867274142", "01108082408", "86410830149", "04016635403", "21409528049", "67220541600", "75218526304", "04244096663", "03883998133", "02424593400",
"04454649332", 
"69876150120", "00480670080", "08667015679", "03597383467", "64986128353", "11293510688", "04333857660", "06656152481", "56954778168", "92635636320", "03731975351", "06673027436", "02247220509", "38486778816", "22386459349", "86216643215", "31932398368", "93795327253", "25860844387", "62501038215", "71615660100", "90339452234", "04552098551", "05244299875", "03761493100", "08832906694", "02749964130", "01850080119", "01553200683", "06246712673", "95917500053", "25875841320", "76892743315", "31694748472", "02342517513", "52994929104", "38898594372", "85310824391", "30686049829", "01137161337", "00296946125", "30999146300", "01001288319", "01554774551", "10389023639", "01908475579", "60511362749",
"76905810304", "89579461368", "72547880300", "05396381370", "65854187353", "76426459372", "87290650387", "00710366361", "92949185304", "37727885304", "49162462334", "44358539300", "75414503320", "61962180344", "95535888320", "04861610486", "70841136300", "70570140315", "42064554653", "71498915353", "78162939334", "01164474359", "46352090320", "00365736392", "74530410315", "61610100387", "01491042354", "84181060349", "46958525353", "02214894365", "02271382360", "24757993315", "53173619315", "50023292334", "89883128304", "78655277304", "01661149367", "02752072341", "04806754307", "03613477319", "67233309353", "65662113300", "22882588372", "03491535310", "79867316304", "84269464372", "05903446337", "04310984339", "95981632372", "30015669300", "02607064341", "45606110334", "02364434378", "01554434378", "60051875381", "00538913339", "23028050382", "04038782336", "23196629368", "61756989320", "73591262315", "00551726369"];
for($i=0;$i<count($cpfs);$i++) {
	$sql = "select 	itp.nome, itp.codigo_cbo, itp.estabelecimento_codigo_cnes, coalesce(itp.equipe_codigo_ine, 'null') as equipe_codigo_ine, tu.fl_sexo
from integracao.tb_profissional as itp 
inner join tb_profissional tp on(itp.cpf=replace(replace(tp.nr_cpf, '.', ''), '-', ''))
inner join tb_usuario tu on(tp.ci_profissional=tu.ci_usuario)
where itp.cpf = '" . $cpfs[$i] . "'
";	
	$q = query($sql)->fetch();
	if($q['codigo_cbo'] != '' || $q['estabelecimento_codigo_cnes'] != '') {
		$fl_sexo = "M";
		if($q['fl_sexo'] == '2'){
			$fl_sexo = "F";
		}
		
		$cnes = $q['estabelecimento_codigo_cnes'];
		if(strlen($cnes) == 4){
			$cnes = '000'.$cnes;
		}
		if(strlen($cnes) == 5){
			$cnes = '00'.$cnes;
		}
		
		$profissionalTeleconsultorias->addProfissionalSaude(null, $cpfs[$i], $q['nome'], $cnes, $q['codigo_cbo'], null, "02", $fl_sexo);
	}
}*/


/*
Código de identificação 
Data/hora de início do curso
Data/hora de término do curso
Número de vagas ofertadas
Tema do curso
Carga horaria do curso - Número em minutos
Alunos matriculados	(opcional) Lista de CPFs separados por vírgula dos alunos matriculados	Em um primeiro momento, o SMART recebe apenas os dados do curso para cadastro, depois poderá receber a lista de CPFs
Alunos formados	(opcional) Lista de CPFs separados por vírgula dos alunos formados	Quando o curso tiver sido encerrado, poderá enviar os dados do curso com a lista de formados
Alunos evadidos	(opcional) Lista de CPFs separados por vírgula dos alunos evadidos	Quando o curso tiver sido encerrado, poderá enviar os dados do curso com a lista de evadidos
Alunos reprovados	(opcional) Lista de CPFs separados por vírgula dos alunos reprovados	Quando o curso tiver sido encerrado, poderá enviar os dados do curso com a lista de reprovados
*/



$curso = new TeleeducacaoCurso("0000088", "022018");
$curso->addCurso("CDTPS2018A1", "06/02/2018 00:00:00", "28/02/2018 00:00:00", "80", "C02.782.350.250.214", "1200", 
//matriculados
createNewArrayCPFS(["04868374320", "00851509320", "54696585387", "00548345384", "60085170321", "04254190379", "66869374368", "02337497305", "02214894365", "63061775315", "73186988268", "67233309353", "85310824391", "02720165352", "09477586234", "02555133305", "02643739361"]), 
//concluintes
createNewArrayCPFS(["02337497305", "02214894365", "73186988268"]), 
//evadidos
createNewArrayCPFS(["04868374320", "00851509320", "54696585387", "00548345384", "60085170321", "04254190379", "66869374368", "63061775315", "67233309353", "85310824391", "02720165352", "09477586234", "02555133305", "02643739361"]), 
//reprovados
createNewArrayCPFS([]));



//$curso = new TeleeducacaoCurso("0000088", "022018");
$curso->addCurso("CDTPS2018A2", "06/02/2018 00:00:00", "28/02/2018 00:00:00", "80", "C02.782.350.250.214", "1200", 
//matriculados
createNewArrayCPFS(["00971643130", "01749710528", "05740028981", "01676766103", "03580446509", "06544842109", "04577121476", "92212646020", "02463413190", "91458218287", "00386012148", "01394992106", "84912162000", "54972280700", "07052534495", "02599765471", "02536038114", "10705472477", "07492444109", "02598721136", "05238044402", "32394395818", "22905328860", "04096219193", "01451281560", "08866220426", "04160850596", "04068366551", "01392191297", "13989667700", "07303524479", "04007982120", "02567018492", "03799303405", "76114058291", "02355025100", "86010913187", "06732246194", "07225661400", "30966809149", "23665475287", "83079769015", "03578522147", "00629310084", "03147019586", "05146260117", "01716570123", "03198418127", "03523891175", "00965311180", "64039129172", "59088346534", "86515407521", "05887315440", "96980419072", "02386866556", "04622829452", "03867274142", "04770690100", "04720291422", "05912233170", "08100536163", "81609442253"]), 
//concluintes
createNewArrayCPFS(["04577121476", "91458218287", "00386012148", "01394992106", "02599765471", "04096219193", "05912233170"]), 
//evadidos
createNewArrayCPFS(["00971643130", "01749710528", "05740028981", "01676766103", "03580446509", "06544842109", "92212646020", "02463413190", "84912162000", "54972280700", "07052534495", "02536038114", "10705472477", "07492444109", "02598721136", "05238044402", "32394395818", "22905328860", "01451281560", "08866220426", "04160850596", "04068366551", "01392191297", "13989667700", "07303524479", "04007982120", "02567018492", "03799303405", "76114058291", "02355025100", "86010913187", "06732246194", "07225661400", "30966809149", "23665475287", "83079769015", "03578522147", "00629310084", "03147019586", "05146260117", "01716570123", "03198418127", "03523891175", "00965311180", "64039129172", "59088346534", "86515407521", "05887315440", "02386866556", "04622829452", "03867274142", "04770690100", "04720291422", "08100536163", "81609442253"]), 
//reprovados
createNewArrayCPFS(["96980419072"]));




//$curso = new TeleeducacaoCurso("0000088", "022018");
$curso->addCurso("CDTPS2018A3", "06/02/2018 00:00:00", "28/02/2018 00:00:00", "80", "C02.782.350.250.214", "1200", 
//matriculados
createNewArrayCPFS(["08671703797", "08455801751", "96321601004", "83133003020", "02434516017", "04562565128", "04480435131", "04333857660", "00747721041", "06293196422", "85175510363", "99243369172", "00940266539", "01756528055", "60285818449", "00416512003", "88768716168", "12302094760", "04103354364", "30208624856", "01950186130", "50912690534", "03341944583", "01800737106", "85392308104", "00771177194", "78679001104", "05149138436", "93080700368", "02341428126", "83414541149", "71615687300", "07686095770", "00378336002", "51275040578", "70003460193", "54637023149", "04806754307", "63338343353", "22360492500", "05544988471", "03046609140", "92242723553", "70336482191", "02095508300", "01877595535", "98313720182", "94714797620", "04625245311", "71076522068", "01554774551", "13484331836", "04078884466", "73270563191", "78814073791", "03829229488", "02568825413"]), 
//concluintes
createNewArrayCPFS(["02434516017", "01756528055", "00416512003", "01950186130", "78679001104", "71615687300", "70003460193", "04806754307", "73270563191", "78814073791"]), 
//evadidos
createNewArrayCPFS(["08671703797", "08455801751", "96321601004", "83133003020", "04562565128", "04480435131", "04333857660", "00747721041", "06293196422", "85175510363", "99243369172", "00940266539", "60285818449", "88768716168", "12302094760", "04103354364", "30208624856", "50912690534", "03341944583", "01800737106", "85392308104", "00771177194", "93080700368", "02341428126", "83414541149", "00378336002", "51275040578", "54637023149", "63338343353", "22360492500", "05544988471", "03046609140", "92242723553", "70336482191", "02095508300", "01877595535", "98313720182", "94714797620", "04625245311", "71076522068", "01554774551", "13484331836", "04078884466", "03829229488", "02568825413"]), 
//reprovados
createNewArrayCPFS(["05149138436", "07686095770"]));





//$curso = new TeleeducacaoCurso("0000088", "022018");
$curso->addCurso("CZDCPS2018A1", "06/02/2018 00:00:00", "28/02/2018 00:00:00", "80", "C02.081.270", "1200", 
//matriculados
createNewArrayCPFS(["81655380397", "00548345384", "60085170321", "02337497305", "70552579130", "63061775315", "04623342360", "91679494368", "67233309353", "06779243132", "01745206388", "02720165352", "09477586234", "02727890389", "02643739361", "00551726369", "05056443395"]), 
//concluintes
createNewArrayCPFS(["00548345384", "02337497305", "00551726369"]), 
//evadidos
createNewArrayCPFS(["81655380397", "60085170321", "70552579130", "63061775315", "04623342360", "91679494368", "67233309353", "06779243132", "01745206388", "02720165352", "09477586234", "02727890389", "02643739361", "05056443395"]), 
//reprovados
createNewArrayCPFS([]));



//$curso = new TeleeducacaoCurso("0000088", "022018");
$curso->addCurso("CZDCPS2018A2", "06/02/2018 00:00:00", "28/02/2018 00:00:00", "80", "C02.081.270", "1200", 
//matriculados
createNewArrayCPFS(["91914922468", "03846960152", "02730275576", "06600587156", "02537393147", "66091314491", "87889781172", "05851102632", "01676766103", "03580446509", "03799579141", "11416239782", "72738642420", "77074742104", "92212646020", "02463413190", "03587680124", "91458218287", "00386012148", "94440298591", "54972280700", "07052534495", "02599765471", "02315120403", "04867303445", "02743931310", "14738643215", "01819045196", "05238044402", "22905328860", "92123740187", "04068366551", "61235644120", "06077805416", "13989667700", "06712938180", "00620161132", "00278162304", "04007982120", "12657600719", "03140564759", "93939272353", "87114429304", "06732246194", "02623446458", "05569552421", "71171240082", "83079769015", "00629310084", "04400562506", "05146260117", "80246940506", "05418256580", "04474072103", "04393439414", "01758482117", "04713437573", "36925225091", "04016308542", "00422873160", "86515407521", "96980419072", "04440019137", "01669874176", "04622829452", "81609442253"]), 
//concluintes
createNewArrayCPFS(["91458218287", "00386012148", "94440298591", "02599765471", "04867303445", "01758482117", "96980419072"]), 
//evadidos
createNewArrayCPFS(["91914922468", "03846960152", "02730275576", "06600587156", "02537393147", "66091314491", "87889781172", "05851102632", "01676766103", "03580446509", "03799579141", "11416239782", "72738642420", "77074742104", "92212646020", "02463413190", "03587680124", "54972280700", "07052534495", "02315120403", "02743931310", "14738643215", "01819045196", "05238044402", "22905328860", "92123740187", "04068366551", "61235644120", "06077805416", "13989667700", "06712938180", "00620161132", "00278162304", "04007982120", "12657600719", "93939272353", "87114429304", "06732246194", "02623446458", "05569552421", "71171240082", "83079769015", "00629310084", "04400562506", "05146260117", "80246940506", "05418256580", "04474072103", "04393439414", "04713437573", "36925225091", "04016308542", "00422873160", "86515407521", "04440019137", "01669874176", "04622829452", "81609442253"]), 
//reprovados
createNewArrayCPFS(["03140564759"]));


//$curso = new TeleeducacaoCurso("0000088", "022018");
$curso->addCurso("CZDCPS2018A3", "06/02/2018 00:00:00", "28/02/2018 00:00:00", "80", "C02.081.270", "1200", 
//matriculados
createNewArrayCPFS(["57346321120", "04480435131", "04333857660", "00747721041", "06293196422", "01756528055", "00707869501", "56583532034", "00416512003", "67911463034", "88768716168", "12302094760", "05871202667", "06363588600", "00366253107", "50912690534", "02120253099", "03341944583", "25880365387", "01800737106", "01159270007", "83791795104", "05149138436", "05017207406", "02341428126", "08578983700", "83414541149", "78580218349", "00630372381", "04545746144", "51275040578", "09978808485", "54637023149", "00176561501", "04806754307", "26928351829", "01197350080", "22360492500", "03489995775", "03046609140", "01813403309", "96895209034", "03183933101", "01504872070", "01877595535", "98313720182", "94714797620", "10771094744", "79028853120", "96273305234", "04078884466", "73270563191", "08619429736", "03829229488", "78643449504", "02271270138", "02568825413", "69514550404", "01923449516"]), 
//concluintes
createNewArrayCPFS(["01756528055", "00416512003", "02120253099", "03341944583", "05149138436", "83414541149", "00630372381", "04806754307", "26928351829", "73270563191"]), 
//evadidos
createNewArrayCPFS(["57346321120", "04480435131", "04333857660", "00747721041", "06293196422", "00707869501", "56583532034", "67911463034", "88768716168", "12302094760", "05871202667", "06363588600", "00366253107", "50912690534", "25880365387", "01800737106", "01159270007", "83791795104", "05017207406", "02341428126", "08578983700", "78580218349", "04545746144", "51275040578", "09978808485", "54637023149", "00176561501", "01197350080", "22360492500", "03489995775", "03046609140", "01813403309", "96895209034", "03183933101", "01504872070", "01877595535", "98313720182", "94714797620", "10771094744", "79028853120", "96273305234", "04078884466", "08619429736", "03829229488", "78643449504", "02271270138", "02568825413", "69514550404", "01923449516"]), 
//reprovados
createNewArrayCPFS([]));

////////////////////////////////////////////////////////////////
//INTEGRA
$url = 'http://smart.telessaude.ufrn.br/';
$integra = new Integra("ad9c2aa3622033fc9d79703fde22a4e892641221");



/*echo "<br/><br/><fieldset><legend>Teleconsultoria - Profissionais de Saúde</legend>";
$dados_profissionalTeleconsultorias = Integra::serializar(TipoDeDados::JSON, $profissionalTeleconsultorias);
echo "<h3>.: Dados Serializados - Profissional de Saúde :.</h3>";
echo $dados_profissionalTeleconsultorias;
$resposta_profissional = $integra->enviarDados(TipoDeDados::JSON, $url."api/v2/profissionais-saude/?format=json", $dados_profissionalTeleconsultorias);
echo "<h3>.: Resposta do Servidor - Profissional de Saúde :.</h3>";
echo $resposta_profissional;
echo "</fieldset>";
*/

////////////////////////////////////////////////////////////////
//1 - Cursos

echo "<br/><br/><fieldset><legend>Cursos</legend>";
$dados_serializados_curso = Integra::serializar(TipoDeDados::JSON, $curso);
echo "<h3>.: Dados Serializados - Curso :.</h3>";
echo $dados_serializados_curso;
$resposta_curso = $integra->enviarDados(TipoDeDados::JSON, $url."api/v2/cursos-teleeducacao/?format=json", $dados_serializados_curso);
echo "<h3>.: Resposta do Servidor - Curso :.</h3>";
echo $resposta_curso;
echo "</fieldset>";





?>